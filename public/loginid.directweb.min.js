/* eslint-disable */
/*
 * Module : LoginID - directweb
 * Version: 0.9.5
 **/
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("LoginID",[],t):"object"==typeof exports?exports.LoginID=t():(e.LoginID=e.LoginID||{},e.LoginID.directweb=t())}(self,(function(){return(()=>{"use strict";var e={910:(e,t,i)=>{i.r(t),i.d(t,{DirectWeb:()=>f,default:()=>h});var n=i(655);const o=e=>e.replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,""),r={bad_request:"Bad request",user_already_registered:"Username unavailable",client_not_created:"Client not created",client_not_updated:"Client not updated",client_not_deleted:"Client not deleted",client_not_activated:"Client not activated",client_not_deactivated:"Client not deactivated",client_not_verified:"Client not verified",client_history_not_created:"Client history not created",oidc_client_not_created:"OIDC client not created",oidc_client_not_deleted:"OIDC client not deleted",oidc_organization_not_found:"OIDC organization not found",oidc_scope_not_allowed:"OIDC scope not allowed",hydra_client_not_created:"Hydra client not created",hydra_client_not_deleted:"Hydra client not deleted",username_taken:"Username Unavailable",username_empty:"Username Empty",username_invalid:"Username Invalid",user_not_created:"User not created",user_not_updated:"User not updated",user_not_verified:"User not verified",credential_not_created:"Credential not created",user_activity_not_recorded:"User activity not recorded",user_device_not_created:"User device not created",request_validation_error:"Request Validation Error",query_failed:"Query Failed",missing_parameter:"Missing Parameter",failed_to_send_email:"Failed to send email",invalid_registration_code:"Invalid Registration Code",invalid_access_code:"Invalid Access Code",invalid_registration_link:"Invalid registration link",expired_registration_link:"Expired registration link",too_manny_registration_attempts:"Too many registration attempts",failed_to_authenticate:"Failed to authenticate",unauthorized:"Unauthorized",operation_not_allowed:"You do not have a permission to complete this action.",invalid_credential:"Invalid credentials",insufficient_license:"You do not have permission to complete this action. Please sign the appropriate agreements.",invalid_jwt:"Invalid token",forbidden:"Forbidden",endpoint_deprecated:"Error code: D3TVC3RP3D",not_found:"Not found",oidc_client_not_found:"OIDC client not found",authenticator_not_found:"Authenticator not found",client_not_found:"Client not found",user_not_found:"User not found",user_device_not_found:"User device not found",credential_not_found:"Credential not found",not_acceptable:"Unacceptable",oidc_max_client_reached:"OIDC max client limit reached",internal_server_error:"An Internal Error has occurred",database_error:"A Major Internal Error has occurred",missing_body:"Missing body",missing_authentication_method:"Missing Authentication",oidc_server_error:"OIDC server error",account_deactivated:"Account is deactivated",remote_session_not_found:"Authentication session not found",remote_session_in_progress:"Authentication session in progress",remote_session_timeout:"The session has timed out",remote_session_maximum_retry_attempts:"Session maximum retry attempts",invalid_verification_code:"Invalid verification code",verification_code_not_found:"Verification code not found",verification_code_expired:"Verification code has expired"},a=e=>{const t=r[e];return void 0!==t?t:"An unknown error has occurred"};class s extends Error{constructor(e,t,i){super(t),this.name="LoginSDK-Error",this.code=e,this.errors=i}}class d extends Error{constructor(){super("Your Identity could not be verified"),this.name="NavigatorError"}}const c={"Content-Type":"application/json"},l={base64EncodeUrl:o,base64ToBuffer:e=>{const t=(e=>{let t,i,n,o={},r=0,a=0,s="",d=String.fromCharCode,c=e.length;for(t=0;64>t;t++)o["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(t)]=t;for(i=0;c>i;i++)for(t=o[e.charAt(i)],r=(r<<6)+t,a+=6;a>=8;)((n=255&r>>>(a-=8))||c-2>i)&&(s+=d(n));return s})(e=e.replace(/-/g,"+").replace(/_/g,"/")),i=new Uint8Array(t.length);for(let e=0;e<t.length;e++)i[e]=t.charCodeAt(e);return i.buffer},bufferToBase64:e=>{let t="";const i=new Uint8Array(e);for(let e=0;e<i.byteLength;e++)t+=String.fromCharCode(i[e]);const n=(e=>{let t,i,n,o,r,a,s,d,c,l="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",u=0,_=0,f="",h=[];if(!e)return e;do{t=e.charCodeAt(u++),i=e.charCodeAt(u++),n=e.charCodeAt(u++),d=t<<16|i<<8|n,o=63&d>>18,r=63&d>>12,a=63&d>>6,s=63&d,h[_++]=l.charAt(o)+l.charAt(r)+l.charAt(a)+l.charAt(s)}while(u<e.length);return f=h.join(""),c=e.length%3,(c?f.slice(0,c-3):f)+"===".slice(c||3)})(t);return o(n)}},u={post:(e,t,i,o)=>(0,n.mG)(void 0,void 0,void 0,(function*(){const n={method:"post",headers:o=Object.assign(c,o),body:JSON.stringify(i)},r=yield fetch(e+t,n),d=yield r.json();if(r.ok)return d;const{code:l}=d;throw new s(l,a(l),[])}))},_={getCredential:e=>(0,n.mG)(void 0,void 0,void 0,(function*(){try{const t=yield navigator.credentials.get(e);if(null!==t)return t}catch(e){throw console.log(e),new d}throw new d})),createCredential:e=>(0,n.mG)(void 0,void 0,void 0,(function*(){try{const t=yield navigator.credentials.create(e);if(null!==t)return t}catch(e){throw console.log(e),new d}throw new d}))};class f{constructor(e,t){this._baseURL=e,this._apiKey=t}register(e,t=null){return(0,n.mG)(this,void 0,void 0,(function*(){const i=yield this.registerWithFido2(e,t);return{uid:i.credential.uuid,username:i.user.username,namespace:i.user.namespace_id,jwt:i.jwt,user:{id:i.user.id,type:i.user.type}}}))}registerWithFido2(e,t=null){return(0,n.mG)(this,void 0,void 0,(function*(){const i=localStorage.getItem("register_session");let o;t&&t.authorization_token&&(o=t.authorization_token,delete t.authorization_token);const r={client_id:this._apiKey,username:e,options:Object.assign(Object.assign({},t),{register_session:i})};let a=yield u.post(this._baseURL,"/register/fido2/init",r,{Authorization:"Bearer "+o});const{register_session:s,attestation_payload:d}=a,{credential_uuid:c}=d,f=(0,n._T)(d,["credential_uuid"]);localStorage.setItem("register_session",s);const{challenge:h}=f;f.challenge=l.base64ToBuffer(f.challenge),f.user.id=l.base64ToBuffer(f.user.id);const p=yield _.createCredential({publicKey:f}),m=p.response,y={client_id:this._apiKey,username:e,attestation_payload:{challenge:h,credential_uuid:c,credential_id:l.bufferToBase64(p.rawId),client_data:l.bufferToBase64(m.clientDataJSON),attestation_data:l.bufferToBase64(m.attestationObject)}};return yield u.post(this._baseURL,"/register/fido2/complete",y)}))}registerWithPassword(e,t,i){return(0,n.mG)(this,void 0,void 0,(function*(){return yield u.post(this._baseURL,"/register/password",{client_id:this._apiKey,username:e,password:t,password_confirmation:i})}))}login(e,t=null){return(0,n.mG)(this,void 0,void 0,(function*(){const i=yield this.loginWithFido2(e,t);return{uid:i.credential.uuid,username:i.user.username,namespace:i.user.namespace_id,jwt:i.jwt,user:{id:i.user.id,type:i.user.type}}}))}loginWithFido2(e,t=null){return(0,n.mG)(this,void 0,void 0,(function*(){let i;t&&t.authorization_token&&(i=t.authorization_token,delete t.authorization_token);let n={client_id:this._apiKey,username:e,options:t},o=yield u.post(this._baseURL,"/authenticate/fido2/init",n,{Authorization:"Bearer "+i});const{assertion_payload:r}=o,{challenge:a}=r;if(r.challenge=l.base64ToBuffer(r.challenge),r.allowCredentials)for(const e of r.allowCredentials)e.id=l.base64ToBuffer(e.id);const s=yield _.getCredential({publicKey:r}),d=s.response,c={client_id:this._apiKey,username:e,assertion_payload:{challenge:a,credential_id:l.bufferToBase64(s.rawId),client_data:l.bufferToBase64(d.clientDataJSON),authenticator_data:l.bufferToBase64(d.authenticatorData),signature:l.bufferToBase64(d.signature)}};return yield u.post(this._baseURL,"/authenticate/fido2/complete",c)}))}loginWithPassword(e,t){return(0,n.mG)(this,void 0,void 0,(function*(){return yield u.post(this._baseURL,"/authenticate/password",{client_id:this._apiKey,username:e,password:t})}))}pushAuthentication(e,t,i=null){return(0,n.mG)(this,void 0,void 0,(function*(){const n={client_id:this._apiKey,username:e,options:i};let o=yield u.post(this._baseURL,"/push_authentication/init",n);const{code:r,devices:a,notification:s,expire_at:d}=o;t(r,a,s,d);const c=Object.assign(Object.assign({},n),{options:Object.assign(Object.assign({},i),{remote_session:{code:r}})});return yield u.post(this._baseURL,"/push_authentication/complete",c)}))}addAuthenticator(e,t,i=null){return(0,n.mG)(this,void 0,void 0,(function*(){let o={client_id:this._apiKey,username:e,options:i},r=yield u.post(this._baseURL,"/add_authenticator/init",o);const{code:a,devices:s,notification:d,expire_at:c}=r;t(a,s,d,c);const f=Object.assign(Object.assign({},o),{options:Object.assign(Object.assign({},i),{remote_session:{code:a}})}),h=yield u.post(this._baseURL,"/add_authenticator/complete",f),p=Object.assign(Object.assign({},o),{options:{remote_session:{session_id:h.registration_session}}}),m=yield u.post(this._baseURL,"/add_authenticator/init",p),{uid:y,session_id:g}=m,b=(0,n._T)(m,["uid","session_id"]);localStorage.setItem("register_session_id",g);const{challenge:v}=b;b.challenge=l.base64ToBuffer(b.challenge),b.user.id=l.base64ToBuffer(b.user.id);const w=yield _.createCredential({publicKey:b}),O=w.response,C=Object.assign(Object.assign({},p),{payload:{challenge:v,id:l.bufferToBase64(w.rawId),raw_id:l.bufferToBase64(w.rawId),credential_id:y,client_data:l.bufferToBase64(O.clientDataJSON),attestation_data:l.bufferToBase64(O.attestationObject)}});return yield u.post(this._baseURL,"/add_authenticator/complete",C)}))}createTransaction(e,t){return(0,n.mG)(this,void 0,void 0,(function*(){const i={tx_type:e.tx_type,tx_payload:e.tx_payload,nonce:e.nonce,username:e.username,client_id:this._apiKey};return this.confirmTransaction(i,t)}))}createTransactionIframe(e,t,i,o){return(0,n.mG)(this,void 0,void 0,(function*(){const n={tx_type:e.tx_type,tx_payload:e.tx_payload,nonce:e.nonce,username:e.username,client_id:this._apiKey},r=yield u.post(this._baseURL,"/api/tx",n,{Authorization:"Bearer "+t}),a=document.createElement("iframe");a.src=r.url,a.setAttribute("id","tx-details-iframe"),a.style.width="100%",a.style.height="100%",i.appendChild(a);const s=document.createElement("button");s.setAttribute("id","tx-details-confirm-btn"),s.innerText="Confirm Transaction";const d={tx_id:r.id,username:e.username,client_id:this._apiKey};s.onclick=()=>this.confirmTransaction(d,t,o),i.appendChild(s)}))}confirmTransaction(e,t,i){return(0,n.mG)(this,void 0,void 0,(function*(){e.client_id=this._apiKey;const n=yield u.post(this._baseURL,"/api/tx/init",e,{Authorization:"Bearer "+t}),o=n.assertion_options,r=n.tx_id,{challenge:a}=o;if(o.challenge=l.base64ToBuffer(o.challenge),o.allowCredentials)for(const e of o.allowCredentials)e.id=l.base64ToBuffer(e.id);const s=yield _.getCredential({publicKey:o}),d=s.response;let c={username:e.username,tx_id:r,client_id:this._apiKey,challenge:a,key_handle:l.bufferToBase64(s.rawId),client_data:l.bufferToBase64(d.clientDataJSON),auth_data:l.bufferToBase64(d.authenticatorData),sign_data:l.bufferToBase64(d.signature)};const f=yield u.post(this._baseURL,"/api/tx/complete",c);if("function"!=typeof i)return f;i(f)}))}}const h=f},655:(e,t,i)=>{function n(e,t){var i={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(i[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(n=Object.getOwnPropertySymbols(e);o<n.length;o++)t.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(e,n[o])&&(i[n[o]]=e[n[o]])}return i}function o(e,t,i,n){return new(i||(i=Promise))((function(o,r){function a(e){try{d(n.next(e))}catch(e){r(e)}}function s(e){try{d(n.throw(e))}catch(e){r(e)}}function d(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,s)}d((n=n.apply(e,t||[])).next())}))}i.d(t,{_T:()=>n,mG:()=>o}),Object.create,Object.create}},t={};function i(n){if(t[n])return t[n].exports;var o=t[n]={exports:{}};return e[n](o,o.exports,i),o.exports}return i.d=(e,t)=>{for(var n in t)i.o(t,n)&&!i.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),i.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i(910)})()}));
